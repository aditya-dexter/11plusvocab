<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>11+ Vocab Flashcards</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    colors: {
                        'primary': '#4f46e5',
                        'secondary': '#f97316',
                    }
                }
            }
        }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
        }

        /* Flashcard 3D flip styling */
        .flashcard {
            width: 100%;
            height: 380px; 
            perspective: 1500px;
            cursor: pointer;
        }

        .card-inner {
            position: relative;
            width: 100%;
            height: 100%;
            text-align: center;
            transition: transform 0.8s;
            transform-style: preserve-3d;
            /* Added a stronger shadow to the inner card for a 3D lift */
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            border-radius: 1.5rem; 
        }

        .flashcard.flipped .card-inner {
            transform: rotateY(180deg);
        }

        .card-face {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 2.5rem; 
            border-radius: 1.5rem; /* Ensure radius is on the faces */
            transition: background-color 0.3s;
            overflow-y: auto; 
        }

        /* * FIXED: Replaced unreliable theme() calls with CSS linear-gradients 
         * for colorful, 3D-style cards.
        */
        .card-front {
            /* Warm yellow-to-orange gradient */
            background: linear-gradient(135deg, #fde047, #f97316);
            border: 1px solid #f97316;
        }

        .card-back {
            /* Cool light-blue-to-indigo gradient */
            background: linear-gradient(135deg, #7dd3fc, #4f46e5);
            transform: rotateY(180deg);
            border: 1px solid #4f46e5;
            text-align: left;
            justify-content: flex-start; /* Align content to top */
            align-items: flex-start;
        }
        
        /* Custom scrollbar for the card back (WebKit browsers) */
        .card-back::-webkit-scrollbar {
            width: 8px;
        }
        .card-back::-webkit-scrollbar-thumb {
            background-color: #4f46e5; /* Scrollbar color */
            border-radius: 10px;
        }
        .card-back::-webkit-scrollbar-track {
            background-color: #a5b4fc; /* Track color */
        }
    </style>
</head>
<body class="bg-sky-50 min-h-screen flex flex-col items-center p-4 sm:p-8">

    <div class="max-w-3xl w-full">
        <!-- Header -->
        <header class="text-center mb-8">
            <h1 class="text-4xl sm:text-5xl font-extrabold text-gray-900 mb-2 bg-gradient-to-r from-primary to-secondary bg-clip-text text-transparent">
                11+ Vocab Flashcards
            </h1>
            <p class="text-lg sm:text-xl text-gray-600">
                Choose a set and start practicing. Click the card to flip it!
            </p>
        </header>

        <!-- App Container -->
        <main id="app-container" class="w-full">
            <!-- Set Selector Card -->
            <div class="bg-white p-6 rounded-2xl shadow-lg mb-6">
                <label for="set-selector" class="block text-lg font-semibold text-gray-800 mb-3">
                    Choose Vocabulary Set:
                </label>
                <select id="set-selector" 
                        class="block w-full py-3 px-4 border border-gray-300 bg-white rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary text-gray-900 text-lg transition duration-200">
                    <option>Loading sets...</option>
                </select>
            </div>

            <!-- Status Message Area -->
            <div id="status-message" class="text-center p-4 rounded-xl text-lg hidden mb-6"></div>

            <!-- Flashcard Deck Area -->
            <div id="flashcard-deck" class="hidden">
                <!-- Card Count -->
                <div class="text-center mb-4">
                    <p class="text-base font-medium text-gray-600">
                        Card <span id="card-index" class="font-bold text-gray-900">0</span> of <span id="card-count" class="font-bold text-gray-900">0</span>
                    </p>
                </div>

                <!-- The Flashcard -->
                <div id="card-display" class="flashcard mb-6">
                    <div id="card-inner" class="card-inner">
                        <!-- Card Front -->
                        <div class="card-face card-front">
                            <span class="text-sm text-yellow-900 font-bold mb-4 uppercase tracking-widest">Word</span>
                            <h3 id="card-front-content" class="text-4xl sm:text-5xl font-extrabold text-gray-900"></h3>
                        </div>
                        <!-- Card Back -->
                        <div class="card-face card-back">
                            <!-- Text color changed to white for contrast on gradient -->
                            <span class="text-sm text-indigo-100 font-bold mb-4 uppercase tracking-widest">Definition & Context</span>
                            <div id="card-back-content" class="text-lg text-white leading-relaxed space-y-4">
                                <!-- Content populated by JS -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Navigation Buttons -->
                <nav class="flex justify-center space-x-4">
                    <button id="prev-button" class="p-4 bg-secondary hover:bg-orange-600 text-white rounded-full transition shadow-md hover:shadow-lg disabled:opacity-50 disabled:cursor-not-allowed hover:scale-110 active:scale-95" disabled>
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M15 19l-7-7 7-7"></path></svg>
                    </button>
                    <button id="next-button" class="p-4 bg-secondary hover:bg-orange-600 text-white rounded-full transition shadow-md hover:shadow-lg disabled:opacity-50 disabled:cursor-not-allowed hover:scale-110 active:scale-95" disabled>
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M9 5l7 7-7 7"></path></svg>
                    </button>
                </nav>
            </div>
        </main>
    </div>

    <!-- 
      1. Load the vocabulary data first.
    -->
    <script src="set.js"></script>

    <!-- 
      2. Load the application logic script.
    -->
    <script>
        window.addEventListener('DOMContentLoaded', () => {

            let fullDeck = [];
            let currentDeck = [];
            let currentCardIndex = 0;
            let setNames = [];

            const statusMessageEl = document.getElementById('status-message');
            const deckEl = document.getElementById('flashcard-deck');
            const cardDisplayEl = document.getElementById('card-display');
            const cardInnerEl = document.getElementById('card-inner');
            const cardFrontContentEl = document.getElementById('card-front-content');
            const cardBackContentEl = document.getElementById('card-back-content');
            const cardIndexEl = document.getElementById('card-index');
            const cardCountEl = document.getElementById('card-count');
            const prevButton = document.getElementById('prev-button');
            const nextButton = document.getElementById('next-button');
            const setSelector = document.getElementById('set-selector');

            function initializeApp() {
                try {
                    // Check if data loaded
                    if (typeof VOCAB_BY_SET === 'undefined' || !VOCAB_BY_SET) {
                        setSelector.innerHTML = '<option>Error: Data not found</option>';
                        setStatus("Error: Could not load vocabulary data from set.js. The file might be missing or broken.", true);
                        return;
                    }

                    // Clear "Loading..." message
                    setSelector.innerHTML = ''; 

                    setNames = Object.keys(VOCAB_BY_SET);
                    
                    fullDeck = [];
                    setNames.filter(name => name !== "All Sets").forEach(setName => {
                        if (Array.isArray(VOCAB_BY_SET[setName])) {
                            fullDeck = fullDeck.concat(VOCAB_BY_SET[setName]);
                        } else {
                            console.warn(`Data for set "${setName}" is not an array.`);
                        }
                    });
                    
                    VOCAB_BY_SET["All Sets"] = fullDeck; 

                    setNames.forEach(setName => {
                        const option = document.createElement('option');
                        option.value = setName;
                        let count = Array.isArray(VOCAB_BY_SET[setName]) ? VOCAB_BY_SET[setName].length : 0;
                        option.textContent = `${setName} (${count} cards)`;
                        setSelector.appendChild(option);
                    });
                    
                    setSelector.addEventListener('change', loadDeck);
                    cardDisplayEl.addEventListener('click', flipCard);
                    prevButton.addEventListener('click', () => navigateCard(-1));
                    nextButton.addEventListener('click', () => navigateCard(1));
                    
                    loadDeck();

                } catch (error) {
                    console.error("Initialization failed:", error);
                    setSelector.innerHTML = '<option>Error loading app</option>';
                    setStatus("An error occurred while starting the app. Check the console for details.", true);
                }
            }

            function loadDeck() {
                const selectedSet = setSelector.value;
                currentCardIndex = 0;
                
                const deckData = VOCAB_BY_SET[selectedSet];
                
                if (!Array.isArray(deckData)) {
                    console.error(`No data or invalid data for set: ${selectedSet}`);
                    currentDeck = [];
                    updateUI();
                    return;
                }

                if (selectedSet === "All Sets") {
                    currentDeck = [...deckData].sort(() => Math.random() - 0.5); 
                } else {
                    currentDeck = deckData;
                }
                
                updateUI();
            }

            function updateUI() {
                if (!currentDeck || currentDeck.length === 0) {
                    deckEl.classList.add('hidden');
                    setStatus("No cards found for this set. Please select another.", true);
                    return;
                }

                deckEl.classList.remove('hidden');
                statusMessageEl.classList.add('hidden');

                const card = currentDeck[currentCardIndex];
                
                if (!card || typeof card.front === 'undefined' || typeof card.back === 'undefined') {
                    console.error('Invalid card data at index:', currentCardIndex, card);
                    // Skip this card or show an error
                    if (currentDeck.length > 1) {
                        navigateCard(1); // Try to move to the next card
                    } else {
                        setStatus("Error: Invalid card data found.", true);
                    }
                    return;
                }

                cardFrontContentEl.textContent = card.front;
                cardBackContentEl.innerHTML = formatBackContent(card.back);

                cardIndexEl.textContent = currentCardIndex + 1;
                cardCountEl.textContent = currentDeck.length;

                prevButton.disabled = currentCardIndex === 0;
                nextButton.disabled = currentCardIndex === currentDeck.length - 1;

                cardDisplayEl.classList.remove('flipped');
            }
            
            function formatBackContent(text) {
                if (typeof text !== 'string') return 'Invalid content';
                return text.replace(/\n\n/g, '</p><p>').replace(/\n/g, '<br>');
            }

            function flipCard() {
                cardDisplayEl.classList.toggle('flipped');
            }

            function navigateCard(direction) {
                const newIndex = currentCardIndex + direction;
                if (newIndex >= 0 && newIndex < currentDeck.length) {
                    currentCardIndex = newIndex;
                    updateUI();
                }
            }

            function setStatus(message, isError = false) {
                statusMessageEl.textContent = message;
                statusMessageEl.classList.remove('hidden', 'bg-red-100', 'text-red-700', 'bg-blue-100', 'text-blue-700');
                
                if (isError) {
                    statusMessageEl.classList.add('bg-red-100', 'text-red-700');
                } else {
                    statusMessageEl.classList.add('bg-blue-100', 'text-blue-700');
                    setTimeout(() => statusMessageEl.classList.add('hidden'), 5000);
                }
            }

            initializeApp();
        });
    </script>
</body>
</html>
